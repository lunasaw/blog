(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{337:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"haproxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#haproxy"}},[s._v("#")]),s._v(" HAProxy")]),s._v(" "),t("h2",{attrs:{id:"haproxyä»‹ç»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#haproxyä»‹ç»"}},[s._v("#")]),s._v(" HAProxyä»‹ç»")]),s._v(" "),t("p",[s._v("HAProxy: æ˜¯æ³•å›½äººWilly Tarreauå¼€å‘çš„ä¸€ä¸ªå¼€æºè½¯ä»¶ï¼Œæ˜¯ä¸€æ¬¾åº”å¯¹å®¢æˆ·ç«¯10000ä»¥ä¸Šçš„åŒæ—¶è¿æ¥çš„é«˜æ€§èƒ½çš„TCPå’Œ HTTPè´Ÿè½½å‡è¡¡å™¨ã€‚å…¶åŠŸèƒ½æ˜¯ç”¨æ¥æä¾›åŸºäºcookieçš„æŒä¹…æ€§ï¼Œ åŸºäºå†…å®¹çš„äº¤æ¢ï¼Œè¿‡è½½ä¿æŠ¤çš„é«˜çº§æµé‡ç®¡åˆ¶ï¼Œè‡ªåŠ¨æ•…éšœåˆ‡æ¢ ï¼Œä»¥æ­£åˆ™è¡¨è¾¾å¼ä¸ºåŸºç¡€çš„æ ‡é¢˜æ§åˆ¶è¿è¡Œæ—¶é—´ï¼ŒåŸºäºWebçš„æŠ¥è¡¨ï¼Œé«˜çº§æ—¥å¿—è®°å½•ä»¥å¸®åŠ©æ’é™¤æ•…éšœçš„åº”ç”¨æˆ–ç½‘ç»œåŠå…¶ä»–åŠŸèƒ½ã€‚")]),s._v(" "),t("h2",{attrs:{id:"ç›¸å…³æ¦‚å¿µ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›¸å…³æ¦‚å¿µ"}},[s._v("#")]),s._v(" ç›¸å…³æ¦‚å¿µ")]),s._v(" "),t("h3",{attrs:{id:"ä»£ç†çš„ä½œç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»£ç†çš„ä½œç”¨"}},[s._v("#")]),s._v(" ä»£ç†çš„ä½œç”¨")]),s._v(" "),t("ol",[t("li",[s._v("æ­£å‘ä»£ç†ï¼Œåå‘ä»£ç†")]),s._v(" "),t("li",[s._v("ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥æä¾›ç¼“å­˜åŠŸèƒ½åŠ é€Ÿå®¢æˆ·ç«¯è®¿é—®ï¼ŒåŒæ—¶å¯ä»¥å¯¹ç¼“å­˜æ•°æ®è¿›è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥")]),s._v(" "),t("li",[s._v("å†…å®¹è·¯ç”±ï¼šæ ¹æ®æµé‡ä»¥åŠå†…å®¹ç±»å‹å°†è¯·æ±‚è½¬å‘è‡³ç‰¹å®šçš„æœåŠ¡å™¨")]),s._v(" "),t("li",[s._v("è½¬ç å™¨ï¼šæ”¯æŒå‹ç¼©åŠŸèƒ½ï¼Œå°†æ•°æ®ä»¥å‹ç¼©å½¢å¼å‘é€ç»™å®¢æˆ·ç«¯")])]),s._v(" "),t("h3",{attrs:{id:"ç¼“å­˜çš„ä½œç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç¼“å­˜çš„ä½œç”¨"}},[s._v("#")]),s._v(" ç¼“å­˜çš„ä½œç”¨")]),s._v(" "),t("ol",[t("li",[s._v("å‡å°‘è®¿å†—ä½™å†…å®¹ä¼ è¾“")]),s._v(" "),t("li",[s._v("èŠ‚çœå¸¦å®½ï¼Œç¼“è§£ç½‘ç»œç“¶é¢ˆ")]),s._v(" "),t("li",[s._v("é™ä½äº†å¯¹åŸå§‹æœåŠ¡å™¨çš„è¯·æ±‚å‹åŠ›")]),s._v(" "),t("li",[s._v("é™ä½äº†ä¼ è¾“å»¶è¿Ÿ")])]),s._v(" "),t("h3",{attrs:{id:"è´Ÿè½½å‡è¡¡é›†ç¾¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è´Ÿè½½å‡è¡¡é›†ç¾¤"}},[s._v("#")]),s._v(" è´Ÿè½½å‡è¡¡é›†ç¾¤ï¼š")]),s._v(" "),t("p",[s._v("å››å±‚ï¼š\nlvs, nginx(stream)ï¼Œhaproxy(mode tcp)\nä¸ƒå±‚ï¼š\nhttp: nginx(http, ngx_http_upstream_module), haproxy(mode http), httpd, ats, perlbal, pound...")]),s._v(" "),t("h3",{attrs:{id:"haproxyåŠŸèƒ½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#haproxyåŠŸèƒ½"}},[s._v("#")]),s._v(" HAProxyåŠŸèƒ½")]),s._v(" "),t("p",[s._v("HAProxyæ˜¯TCP / HTTPåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå°¤å…¶é€‚åˆäºé«˜å¯ç”¨æ€§ç¯å¢ƒ\nå¯ä»¥é’ˆå¯¹HTTPè¯·æ±‚æ·»åŠ cookieï¼Œè¿›è¡Œè·¯ç”±åç«¯æœåŠ¡å™¨\nå¯å¹³è¡¡è´Ÿè½½è‡³åç«¯æœåŠ¡å™¨ï¼Œå¹¶æ”¯æŒæŒä¹…è¿æ¥\næ”¯æŒåŸºäºcookieè¿›è¡Œè°ƒåº¦\næ”¯æŒæ‰€æœ‰ä¸»æœåŠ¡å™¨æ•…éšœåˆ‡æ¢è‡³å¤‡ç”¨æœåŠ¡å™¨\næ”¯æŒä¸“ç”¨ç«¯å£å®ç°ç›‘æ§æœåŠ¡\næ”¯æŒä¸å½±å“ç°æœ‰è¿æ¥æƒ…å†µä¸‹åœæ­¢æ¥å—æ–°è¿æ¥è¯·æ±‚\nå¯ä»¥åœ¨åŒå‘æ·»åŠ ï¼Œä¿®æ”¹æˆ–åˆ é™¤HTTPæŠ¥æ–‡é¦–éƒ¨\næ”¯æŒåŸºäºpatternå®ç°è¿æ¥è¯·æ±‚çš„è®¿é—®æ§åˆ¶\né€šè¿‡ç‰¹å®šçš„URIä¸ºæˆæƒç”¨æˆ·æä¾›è¯¦ç»†çš„çŠ¶æ€ä¿¡æ¯\nç‰ˆæœ¬ï¼š1.4 1.5 1.6 1.7 1.8\n"),t("img",{attrs:{src:"https://i.loli.net/2021/01/29/xjDWm63snTL48fG.png",alt:"img"}})]),s._v(" "),t("p",[s._v("æ”¯æŒhttpåå‘ä»£ç†\næ”¯æŒåŠ¨æ€ç¨‹åºçš„åå‘ä»£ç†\næ”¯æŒåŸºäºæ•°æ®åº“çš„åå‘ä»£ç†")]),s._v(" "),t("h2",{attrs:{id:"haproxyç»„æˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#haproxyç»„æˆ"}},[s._v("#")]),s._v(" HAproxyç»„æˆ")]),s._v(" "),t("p",[s._v("åŒ…åï¼šhaproxy")]),s._v(" "),t("h3",{attrs:{id:"ç¨‹åºç¯å¢ƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç¨‹åºç¯å¢ƒ"}},[s._v("#")]),s._v(" ç¨‹åºç¯å¢ƒ")]),s._v(" "),t("p",[s._v("ä¸»ç¨‹åºï¼š/usr/sbin/haproxy\né…ç½®æ–‡ä»¶ï¼š/etc/haproxy/haproxy.cfg\nUnit fileï¼š/usr/lib/systemd/system/haproxy.service")]),s._v(" "),t("h3",{attrs:{id:"é…ç½®æ–‡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®æ–‡ä»¶"}},[s._v("#")]),s._v(" é…ç½®æ–‡ä»¶")]),s._v(" "),t("p",[s._v("haproxy.cfgä¸»è¦æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼šglobalï¼Œå’Œproxiesé…ç½®æ®µ")]),s._v(" "),t("h4",{attrs:{id:"global-å…¨å±€é…ç½®æ®µ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#global-å…¨å±€é…ç½®æ®µ"}},[s._v("#")]),s._v(" globalï¼šå…¨å±€é…ç½®æ®µ")]),s._v(" "),t("p",[s._v("è¿›ç¨‹åŠå®‰å…¨é…ç½®ç›¸å…³çš„å‚æ•°\næ€§èƒ½è°ƒæ•´ç›¸å…³å‚æ•°\nDebugå‚æ•°")]),s._v(" "),t("h4",{attrs:{id:"proxies-ä»£ç†é…ç½®æ®µ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#proxies-ä»£ç†é…ç½®æ®µ"}},[s._v("#")]),s._v(" proxiesï¼šä»£ç†é…ç½®æ®µ")]),s._v(" "),t("p",[s._v("defaultsï¼šä¸ºfrontend, backend, listenæä¾›é»˜è®¤é…ç½®\nfrontedï¼šå‰ç«¯ï¼Œç›¸å½“äºnginx, server {}\nbackendï¼šåç«¯ï¼Œç›¸å½“äºnginx, upstream {}\nlistenï¼šåŒæ—¶æ‹¥æœ‰å‰ç«¯å’Œåç«¯,é€‚ç”¨äºä¸€å¯¹ä¸€ç¯å¢ƒ")]),s._v(" "),t("h3",{attrs:{id:"ç®€å•å‰ç«¯è°ƒåº¦å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç®€å•å‰ç«¯è°ƒåº¦å®ç°"}},[s._v("#")]),s._v(" ç®€å•å‰ç«¯è°ƒåº¦å®ç°")]),s._v(" "),t("p",[s._v("åˆ©ç”¨å››å°è™šæ‹Ÿæœºå®ç°ç®€å•çš„å‰ç«¯è½®è¯¢è°ƒåº¦ã€‚\nä¸€å°å®¢æˆ·ç«¯ï¼Œä¸€å°haproxyè°ƒåº¦å™¨ï¼Œä¸¤å°RS")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("é¦–å…ˆåœ¨åç«¯éƒ¨ç½²ä¸¤å°httpæœåŠ¡")])]),s._v(" "),t("li",[t("p",[s._v("ç¼–è¾‘haproxyé…ç½®æ–‡ä»¶/etc/haproxy/haproxy.cfg\né»˜è®¤è®¾ç½®ä¸åšä¿®æ”¹")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS6 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/haproxy/haproxy.cfg ")]),s._v("\nfrontend  main *:80     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è®¾ç½®ç›‘å¬ipï¼šç«¯å£")]),s._v("\ndefault_backend         websrvs     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è°ƒç”¨åç«¯RSç»„å")]),s._v("\nbackend websrvs\nbalance     roundrobin      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è½®è¯¢ç®—æ³•")]),s._v("\nserver      web1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".45.11:80 check\nserver      web2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".45.12:80 check\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®"}},[s._v("#")]),s._v(" é…ç½®")]),s._v(" "),t("h3",{attrs:{id:"globalé…ç½®å‚æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#globalé…ç½®å‚æ•°"}},[s._v("#")]),s._v(" globalé…ç½®å‚æ•°ï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("global      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å…¨å±€å‚æ•°çš„è®¾ç½®")]),s._v("\nlog         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1   local2                      \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# logè¯­æ³•ï¼šlog <address_1>[max_level_1] ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å…¨å±€çš„æ—¥å¿—é…ç½®ï¼Œä½¿ç”¨logå…³é”®å­—ï¼ŒæŒ‡å®šä½¿ç”¨127.0.0.1ä¸Šçš„syslogæœåŠ¡ä¸­çš„local0æ—¥å¿—è®¾å¤‡ï¼Œè®°å½•æ—¥å¿—ç­‰çº§ä¸ºinfoçš„æ—¥å¿—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chroot")]),s._v("      /var/lib/haproxy        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æ”¹å˜å½“å‰å·¥ä½œç›®å½•")]),s._v("\npidfile     /var/run/haproxy.pid    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å½“å‰è¿›ç¨‹idæ–‡ä»¶")]),s._v("\nmaxconn     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v("                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æœ€å¤§è¿æ¥æ•°")]),s._v("\nuser        haproxy                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æ‰€å±ç”¨æˆ·")]),s._v("\ngroup       haproxy                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æ‰€å±ç»„")]),s._v("\ndaemon                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œhaproxy")]),s._v("\nstats socket /var/lib/haproxy/stats "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#åŸºäºæœ¬åœ°çš„æ–‡ä»¶ä¼ è¾“")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("å®ç°æ—¥å¿—è®°å½•ï¼š\nhaproxyé…ç½®æ–‡ä»¶ä¸­é»˜è®¤å®šä¹‰äº†log 127.0.0.1 local2 è¯´æ˜æ—¥å¿—å°†è¢«è®°å½•åœ¨æœ¬æœºçš„local2è®¾æ–½ä¸­ã€‚\nç¼–è¾‘rsyslogé…ç½®æ–‡ä»¶ï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS6 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#vim /etc/rsyslog.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Provides UDP syslog reception")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ModLoad")]),s._v(" imudp      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å–æ¶ˆæ³¨é‡Š")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UDPServerRun")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å–æ¶ˆæ³¨é‡Š")]),s._v("\nlocal2.*            /var/log/haproxy.log\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æŒ‡å®šè®¾å¤‡local2æ—¥å¿—å­˜æ”¾ä½ç½®")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("haproxyçš„æ—¥å¿—ä¿¡æ¯å¯ä»¥è®¾ç½®å­˜æ”¾åœ¨ä¸“é—¨çš„æ—¥å¿—æœåŠ¡å™¨ä¸­")]),s._v(" "),t("h3",{attrs:{id:"proxiesé…ç½®å‚æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#proxiesé…ç½®å‚æ•°"}},[s._v("#")]),s._v(" proxiesé…ç½®å‚æ•°ï¼š")]),s._v(" "),t("p",[s._v("ä»£ç†é…ç½®æ®µï¼š")]),s._v(" "),t("ul",[t("li",[s._v("defaults "),t("name")],1),s._v(" "),t("li",[s._v("frontend "),t("name")],1),s._v(" "),t("li",[s._v("backend "),t("name")],1),s._v(" "),t("li",[s._v("listen "),t("name")],1)]),s._v(" "),t("p",[s._v("Frontendæ®µï¼šæŒ‡å®šæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ä¾¦å¬å¥—æ¥å­—è®¾ç½®\nBackendæ®µï¼šæŒ‡å®šå°†è¿æ¥è¯·æ±‚è½¬å‘è‡³åç«¯æœåŠ¡å™¨çš„ç›¸å…³è®¾ç½®\nListenæ®µï¼šæŒ‡å®šå®Œæ•´çš„å‰åç«¯è®¾ç½®ï¼Œåªå¯¹ TCP æœ‰æ•ˆ\nproxy åç§°ï¼šä½¿ç”¨å­—æ¯ æ•°å­— - _ . : å¹¶åŒºåˆ†å­—ç¬¦å¤§å°å†™")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mode        http             \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#é»˜è®¤çš„æ¨¡å¼mode { tcp|http|health }ï¼Œtcpæ˜¯4å±‚ï¼Œhttpæ˜¯7å±‚ï¼Œhealthåªä¼šè¿”å›OK")]),s._v("\nlog         global        \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#åº”ç”¨å…¨å±€çš„æ—¥å¿—é…ç½®")]),s._v("\noption      httplog       \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯ç”¨æ—¥å¿—è®°å½•HTTPè¯·æ±‚ï¼Œé»˜è®¤haproxyæ—¥å¿—è®°å½•æ˜¯ä¸è®°å½•HTTPè¯·æ±‚æ—¥å¿—")]),s._v("\noption      dontlognull   \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯ç”¨è¯¥é¡¹ï¼Œæ—¥å¿—ä¸­å°†ä¸ä¼šè®°å½•ç©ºè¿æ¥ã€‚æ‰€è°“ç©ºè¿æ¥å°±æ˜¯åœ¨ä¸Šæ¸¸çš„è´Ÿè½½å‡è¡¡å™¨æˆ–è€…ç›‘æ§ç³»ç»Ÿä¸ºäº†æ¢æµ‹è¯¥æœåŠ¡æ˜¯å¦å­˜æ´»å¯ç”¨æ—¶ï¼Œéœ€è¦å®šæœŸçš„è¿æ¥æˆ–è€…è·å–æŸä¸€å›ºå®šçš„ç»„ä»¶æˆ–é¡µé¢ï¼Œæˆ–è€…æ¢æµ‹æ‰«æç«¯å£æ˜¯å¦åœ¨ç›‘å¬æˆ–å¼€æ”¾ç­‰åŠ¨ä½œè¢«ç§°ä¸ºç©ºè¿æ¥ï¼›å®˜æ–¹æ–‡æ¡£ä¸­æ ‡æ³¨ï¼Œå¦‚æœè¯¥æœåŠ¡ä¸Šæ¸¸æ²¡æœ‰å…¶ä»–çš„è´Ÿè½½å‡è¡¡å™¨çš„è¯ï¼Œå»ºè®®ä¸è¦ä½¿ç”¨è¯¥å‚æ•°ï¼Œå› ä¸ºäº’è”ç½‘ä¸Šçš„æ¶æ„æ‰«ææˆ–å…¶ä»–åŠ¨ä½œå°±ä¸ä¼šè¢«è®°å½•ä¸‹æ¥")]),s._v("\noption      http-server-close  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æ¯æ¬¡è¯·æ±‚å®Œæ¯•åä¸»åŠ¨å…³é—­httpé€šé“")]),s._v("\noption      forwardfor       except "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.0/8   \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#å¦‚æœæœåŠ¡å™¨ä¸Šçš„åº”ç”¨ç¨‹åºæƒ³è®°å½•å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯çš„IPåœ°å€ï¼Œéœ€è¦åœ¨HAProxyä¸Šé…ç½®æ­¤é€‰é¡¹ï¼Œ è¿™æ · HAProxyä¼šæŠŠå®¢æˆ·ç«¯çš„IPä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ï¼Œåœ¨HTTPè¯·æ±‚ä¸­æ·»åŠ "X-Forwarded-For"å­—æ®µã€‚å¯ç”¨X-Forwarded-Forï¼Œåœ¨requestså¤´éƒ¨æ’å…¥å®¢æˆ·ç«¯IPå‘é€ç»™åç«¯çš„serverï¼Œä½¿åç«¯serverè·å–åˆ°å®¢æˆ·ç«¯çš„çœŸå®IPã€‚ ')]),s._v("\noption        redispatch                      \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å½“ä½¿ç”¨äº†cookieæ—¶ï¼Œhaproxyå°†ä¼šå°†å…¶è¯·æ±‚çš„åç«¯æœåŠ¡å™¨çš„serverIDæ’å…¥åˆ°cookieä¸­ï¼Œä»¥ä¿è¯ä¼šè¯çš„SESSIONæŒä¹…æ€§ï¼›è€Œæ­¤æ—¶ï¼Œå¦‚æœåç«¯çš„æœåŠ¡å™¨å®•æ‰äº†ï¼Œ ä½†æ˜¯å®¢æˆ·ç«¯çš„cookieæ˜¯ä¸ä¼šåˆ·æ–°çš„ï¼Œå¦‚æœè®¾ç½®æ­¤å‚æ•°ï¼Œå°†ä¼šå°†å®¢æˆ·çš„è¯·æ±‚å¼ºåˆ¶å®šå‘åˆ°å¦å¤–ä¸€ä¸ªåç«¯serverä¸Šï¼Œä»¥ä¿è¯æœåŠ¡çš„æ­£å¸¸ã€‚")]),s._v("\nretries       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                             \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®šä¹‰è¿æ¥åç«¯æœåŠ¡å™¨çš„å¤±è´¥é‡è¿æ¬¡æ•°ï¼Œè¿æ¥å¤±è´¥æ¬¡æ•°è¶…è¿‡æ­¤å€¼åå°†ä¼šå°†å¯¹åº”åç«¯æœåŠ¡å™¨æ ‡è®°ä¸ºä¸å¯ç”¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" http-request    10s     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#httpè¯·æ±‚è¶…æ—¶æ—¶é—´")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" queue           1m      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä¸€ä¸ªè¯·æ±‚åœ¨é˜Ÿåˆ—é‡Œçš„è¶…æ—¶æ—¶é—´")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" connect         10s     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è¿æ¥è¶…æ—¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" client          1m      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å®¢æˆ·ç«¯è¶…æ—¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" server          1m      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æœåŠ¡å™¨ç«¯è¶…æ—¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" http-keep-alive 10s     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è®¾ç½®http-keep-aliveçš„è¶…æ—¶æ—¶é—´")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" check           10s     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æ£€æµ‹è¶…æ—¶")]),s._v("\nmaxconn                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æ¯ä¸ªè¿›ç¨‹å¯ç”¨çš„æœ€å¤§è¿æ¥æ•°")]),s._v("\nfrontend  main *:80             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ç›‘å¬åœ°å€ä¸º80")]),s._v("\nacl url_static       path_beg       -i /static /images /javascript /stylesheets\nacl url_static       path_end       -i .jpg .gif .png .css .js\nuse_backend static          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" url_static\ndefault_backend             my_webserver     \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å®šä¹‰ä¸€ä¸ªåä¸ºmy_appå‰ç«¯éƒ¨åˆ†ã€‚æ­¤å¤„å°†å¯¹åº”çš„è¯·æ±‚è½¬å‘ç»™åç«¯")]),s._v("\nbackend static                                       \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä½¿ç”¨äº†é™æ€åŠ¨æ€åˆ†ç¦»ï¼ˆå¦‚æœurl_pathåŒ¹é… .jpg .gif .png .css .jsé™æ€æ–‡ä»¶åˆ™è®¿é—®æ­¤åç«¯ï¼‰")]),s._v("\nbalance             roundrobin                       \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆ#banlance roundrobin è½®è¯¢ï¼Œbalance source ä¿å­˜sessionå€¼ï¼Œæ”¯æŒstatic-rrï¼Œleastconnï¼Œfirstï¼Œuriç­‰å‚æ•°ï¼‰")]),s._v("\nserver              static "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:80 check         \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#é™æ€æ–‡ä»¶éƒ¨ç½²åœ¨æœ¬æœºï¼ˆä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨å…¶ä»–æœºå™¨æˆ–è€…squidç¼“å­˜æœåŠ¡å™¨ï¼‰")]),s._v("\nbackend my_webserver                                 \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å®šä¹‰ä¸€ä¸ªåä¸ºmy_webserveråç«¯éƒ¨åˆ†ã€‚PSï¼šæ­¤å¤„my_webserveråªæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰åå­—è€Œå·²ï¼Œä½†æ˜¯éœ€è¦ä¸frontendé‡Œé¢é…ç½®é¡¹default_backend å€¼ç›¸ä¸€è‡´")]),s._v("\nbalance     roundrobin          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è´Ÿè½½å‡è¡¡ç®—æ³•")]),s._v("\nserver  web01 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.31")]),s._v(".2.33:80  check inter "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(" fall "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" weight "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å®šä¹‰çš„å¤šä¸ªåç«¯")]),s._v("\nserver  web02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.31")]),s._v(".2.34:80  check inter "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(" fall "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" weight "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å®šä¹‰çš„å¤šä¸ªåç«¯")]),s._v("\nserver  web03 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.31")]),s._v(".2.35:80  check inter "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(" fall "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" weight "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å®šä¹‰çš„å¤šä¸ªåç«¯")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br")])]),t("h3",{attrs:{id:"balanceé…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#balanceé…ç½®"}},[s._v("#")]),s._v(" Balanceé…ç½®")]),s._v(" "),t("p",[s._v("balanceï¼šåç«¯æœåŠ¡å™¨ç»„å†…çš„æœåŠ¡å™¨è°ƒåº¦ç®—æ³•\nbalance "),t("algorithm",[s._v(" [ "),t("arguments",[s._v(" ]\nbalance url_param "),t("param"),s._v(" [check_post]\nhaproxyä¸­è°ƒåº¦ç®—æ³•åŒæ ·åˆ†ä¸ºåŠ¨æ€è°ƒåº¦ç®—æ³•å’Œé™æ€è°ƒåº¦ç®—æ³•ï¼Œä¸nginxè°ƒåº¦ç®—æ³•ä¸­åŒºåˆ†åŠ¨é™æ€è°ƒåº¦ç®—æ³•çš„æ¦‚å¿µä¸åŒï¼Œnginxç”¨èƒ½ä¸èƒ½æ ¹æ®åç«¯æœåŠ¡å™¨çš„è´Ÿè½½çŠ¶å†µè¿›è¡Œè°ƒåº¦æ¥åŒºåˆ†åŠ¨é™æ€è°ƒåº¦ç®—æ³•çš„å·®åˆ«ï¼Œè€Œhaproxyä¸­åˆ™æ ¹æ®è¯¥ç®—æ³•æ”¯ä¸æ”¯æŒè¿è¡Œæ—¶å³æ—¶ç”Ÿæ•ˆæ¥åŒºåˆ†åŠ¨é™æ€ç®—æ³•ã€‚")])],1)],1),s._v(" "),t("p",[s._v("è°ƒåº¦ç®—æ³•ï¼š\nroundrobinï¼šåŸºäºæƒé‡è½®è¯¢ï¼ŒåŠ¨æ€ç®—æ³•ï¼Œæ”¯æŒæƒé‡çš„è¿è¡Œæ—¶è°ƒæ•´ï¼Œæ”¯æŒæ…¢å¯åŠ¨ï¼›æ¯ä¸ªåç«¯backendä¸­æœ€å¤šæ”¯æŒ4095ä¸ª\nserver server optionsï¼š weight #")]),s._v(" "),t("p",[s._v("static-rrï¼šåŸºäºæƒé‡è½®è¯¢ï¼Œé™æ€ç®—æ³•ï¼Œä¸æ”¯æŒæƒé‡çš„è¿è¡Œæ—¶è°ƒæ•´åŠæ…¢å¯åŠ¨ï¼›åç«¯ä¸»æœºæ•°é‡æ— ä¸Šé™")]),s._v(" "),t("p",[s._v("leastconnï¼šåŠ æƒæœ€å°‘è¿æ¥ï¼ŒåŠ¨æ€ç®—æ³•ï¼Œæœ€å°‘è¿æ¥çš„åç«¯æœåŠ¡å™¨ä¼˜å…ˆåˆ†é…æ¥æ”¶æ–°è¿æ¥ï¼Œç›¸åŒè¿æ¥æ—¶è½®è¯¢ï¼Œé€‚ç”¨äºé•¿è¿æ¥åœºæ™¯ï¼Œä¾‹å¦‚ MySQLã€LDAPç­‰ï¼Œä¸é€‚åˆhttp")]),s._v(" "),t("p",[s._v("firstï¼šæ ¹æ®æœåŠ¡å™¨åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ï¼Œè‡ªä¸Šè€Œä¸‹è¿›è¡Œè°ƒåº¦ï¼›å‰é¢æœåŠ¡å™¨çš„è¿æ¥æ•°è¾¾åˆ°ä¸Šé™ï¼Œæ–°è¯·æ±‚æ‰ä¼šåˆ†é…ç»™ä¸‹ä¸€å°æœåŠ¡")]),s._v(" "),t("p",[s._v("sourceï¼šæºåœ°å€hashï¼Œæ–°è¿æ¥å…ˆæŒ‰æƒé‡åˆ†é…ï¼Œåç»­è¿æ¥æŒ‰sourceåˆ†é…è¯·æ±‚\nåŠ¨é™æ€å–å†³äºhash type\nhash-typeï¼šå“ˆå¸Œç®—æ³•\nhash-type "),t("method",[t("function",[t("modifier",[s._v("\nmethod:\nmap-basedï¼šé™¤æƒå–ä½™æ³•ï¼Œå“ˆå¸Œæ•°æ®ç»“æ„æ˜¯é™æ€æ•°ç»„ï¼ˆä¸æ”¯æŒæƒé‡åŠ¨æ€è°ƒæ•´ï¼‰\nconsistentï¼šä¸€è‡´æ€§å“ˆå¸Œï¼Œå“ˆå¸Œæ•°æ®ç»“æ„æ˜¯ä¸€æ£µæ ‘ ï¼ˆæ”¯æŒæƒé‡åŠ¨æ€è°ƒæ•´ï¼‰\n"),t("function",[s._v(" : å“ˆå¸Œå‡½æ•°\nsdbm djb2 wt6")])],1)],1)],1)],1),s._v(" "),t("p",[s._v("uriï¼š\nå¯¹URIçš„å·¦åŠéƒ¨åˆ†æˆ–æ•´ä¸ªuriåšhashè®¡ç®—ï¼Œå¹¶é™¤ä»¥æœåŠ¡å™¨æ€»æƒé‡å–æ¨¡ï¼Œä»¥åæ´¾å‘è‡³æŸæŒ‘å‡ºçš„æœåŠ¡å™¨,é€‚ç”¨äºåç«¯ç¼“å­˜æœåŠ¡å™¨\nåŠ¨é™æ€å–å†³äºhash type")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hash-type\n    map-based\n    consistent\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("scheme",[s._v("ğŸ˜•/"),t("user",[s._v(":"),t("password",[s._v("@"),t("host",[s._v(":"),t("port",[s._v("/"),t("path",[s._v(" ;"),t("params",[s._v("?"),t("query",[s._v("#"),t("frag",[s._v("\nå·¦åŠéƒ¨åˆ†ï¼š/"),t("path",[s._v(";"),t("params",[s._v("\næ•´ä¸ªuriï¼š/"),t("path",[s._v(";"),t("params",[s._v("?"),t("query",[s._v("#"),t("frag")],1)],1)],1)])],1)])],1)],1)],1)])],1)],1)],1)],1)],1),s._v(" "),t("p",[s._v("url_paramï¼š\nå¯¹ç”¨æˆ·è¯·æ±‚çš„uriå¬"),t("params",[s._v("éƒ¨åˆ†ä¸­çš„å‚æ•°çš„å€¼ä½œhashè®¡ç®—ï¼Œ å¹¶ç”±æœåŠ¡å™¨æ€»æƒé‡ç›¸é™¤ä»¥åæ´¾å‘è‡³æŸæŒ‘å‡ºçš„æœåŠ¡å™¨ï¼›é€šå¸¸ç”¨äºè¿½è¸ªç”¨æˆ·ï¼Œä»¥ç¡®ä¿æ¥è‡ªåŒä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚å§‹ç»ˆå‘å¾€åŒä¸€ä¸ªBackend Server\nåŠ¨é™æ€å–å†³äºhash type")])],1),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hash-type\n    map-based\n    consistent\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("hdr("),t("name",[s._v(")ï¼šæ ¹æ®è¯·æ±‚æŠ¥æ–‡ä¸­æŒ‡å®šçš„headerï¼ˆå¦‚use_agent,referer,hostnameï¼‰å°†è¯¥hesderåšhashè®¡ç®—è¿›è¡Œè°ƒåº¦\nåŠ¨é™æ€å–å†³äºhash type")])],1),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hash-type\n    map-based\n    consistent\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("hdr(Cookie)")]),s._v(" "),t("p",[s._v("rdp-cookie è¿œç¨‹æ¡Œé¢ç›¸å…³")]),s._v(" "),t("p",[s._v("rdp-cookie("),t("name",[s._v(")")])],1),s._v(" "),t("h3",{attrs:{id:"default-backend"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#default-backend"}},[s._v("#")]),s._v(" default_backend "),t("backend")],1),s._v(" "),t("p",[s._v("æ— use_backend åŒ¹é…æ—¶ï¼Œä½¿ç”¨é»˜è®¤çš„backendï¼Œç”¨äº frontendä¸­")]),s._v(" "),t("h3",{attrs:{id:"server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#server"}},[s._v("#")]),s._v(" server")]),s._v(" "),t("p",[s._v("server "),t("name",[t("address",[s._v("[:[port]] [param*]\nå®šä¹‰åç«¯ä¸»æœºçš„å„æœåŠ¡å™¨åŠå…¶é€‰é¡¹ server "),t("name",[t("address",[s._v("[:port] [settings ...] default-server [settings ...]")])])],1)])],1),s._v(" "),t("p",[t("name",[s._v("ï¼šæœåŠ¡å™¨åœ¨haproxyä¸Šçš„å†…éƒ¨åç§°ï¼›å‡ºç°åœ¨æ—¥å¿—åŠè­¦å‘Šä¿¡æ¯")])],1),s._v(" "),t("address",[s._v("ï¼šæœåŠ¡å™¨åœ°å€ï¼Œæ”¯æŒä½¿ç”¨ä¸»æœºå\n"),t("p",[s._v("[:[port]]ï¼šç«¯å£æ˜ å°„ï¼›çœç•¥æ—¶ï¼Œè¡¨ç¤ºåŒbindä¸­ç»‘å®šçš„ç«¯å£")]),s._v(" "),t("p",[s._v("[param*]ï¼šå‚æ•°\ncheckï¼šå¯¹å½“å‰serveråšå¥åº·çŠ¶æ€æ£€æµ‹ï¼Œåªç”¨äºå››å±‚æ£€æµ‹\næ³¨æ„ï¼šhttpchkï¼Œâ€œsmtpchkâ€, â€œmysql-checkâ€, â€œpgsql-checkâ€ and â€œsslhello-chkâ€ ç”¨äºå®šä¹‰åº”ç”¨å±‚æ£€æµ‹æ–¹æ³•\naddr ï¼šæ£€æµ‹æ—¶ä½¿ç”¨çš„IPåœ°å€\nport ï¼šé’ˆå¯¹æ­¤ç«¯å£è¿›è¡Œæ£€æµ‹\ninter "),t("delay",[s._v("ï¼šè¿ç»­ä¸¤æ¬¡æ£€æµ‹ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤ä¸º2000ms\nrise "),t("count",[s._v("ï¼šè¿ç»­å¤šå°‘æ¬¡æ£€æµ‹ç»“æœä¸ºâ€œæˆåŠŸâ€æ‰æ ‡è®°æœåŠ¡å™¨ä¸ºå¯ç”¨ ï¼›é»˜è®¤ä¸º2\nfall "),t("count",[s._v("ï¼šè¿ç»­å¤šå°‘æ¬¡æ£€æµ‹ç»“æœä¸ºâ€œå¤±è´¥â€æ‰æ ‡è®°æœåŠ¡å™¨ä¸ºä¸å¯ ç”¨ï¼›é»˜è®¤ä¸º3\ncookie "),t("value",[s._v("ï¼šä¸ºå½“å‰serveræŒ‡å®šcookieå€¼ï¼Œå®ç°åŸºäºcookieçš„ä¼šè¯é»æ€§\ndisabledï¼šæ ‡è®°ä¸ºä¸å¯ç”¨\nredir "),t("prefix",[s._v("ï¼šå°†å‘å¾€æ­¤serverçš„æ‰€æœ‰GETå’ŒHEADç±»çš„è¯·æ±‚é‡å®šå‘è‡³æŒ‡ å®šçš„URL\nweight "),t("weight",[s._v("ï¼šæƒé‡ï¼Œé»˜è®¤ä¸º1\nmaxconn "),t("maxconn",[s._v("ï¼šå½“å‰serverçš„æœ€å¤§å¹¶å‘è¿æ¥æ•°\nbacklog "),t("backlog",[s._v("ï¼šå½“serverçš„è¿æ¥æ•°è¾¾åˆ°ä¸Šé™åçš„åæ´é˜Ÿåˆ—é•¿åº¦\nbackupï¼šè®¾å®šå½“å‰serverä¸ºå¤‡ç”¨æœåŠ¡å™¨")])],1)],1)],1)],1)],1)],1)],1)],1),s._v(" "),t("p",[s._v("default-server [param*] ä¸ºbackendä¸­çš„å„serverè®¾å®šé»˜è®¤é€‰é¡¹")]),s._v(" "),t("h3",{attrs:{id:"bindé…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bindé…ç½®"}},[s._v("#")]),s._v(" bindé…ç½®")]),s._v(" "),t("p",[s._v("bindï¼šæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªå‰ç«¯ä¾¦å¬åœ°å€å’Œç«¯å£\nåªç”¨äºfrountendé…ç½®æ®µå’Œlistené…ç½®æ®µ\nbind [")]),t("address",[s._v("]:<port_range> [, ...] [param*]\nç¤ºä¾‹ï¼š"),t("p"),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("listen http_proxy \n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" :80,:443 \n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.1:10080,10.0.0.1:10443 \n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" /var/run/ssl-frontend.sock user root mode "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" accept-proxy\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"maxconn"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#maxconn"}},[s._v("#")]),s._v(" maxconn")]),s._v(" "),t("p",[s._v("maxconn "),t("conns",[s._v("ï¼šä¸ºæŒ‡å®šçš„frontendå®šä¹‰å…¶æœ€å¤§å¹¶å‘è¿æ¥æ•°ï¼›é»˜è®¤ä¸º2000")])],1),s._v(" "),t("h3",{attrs:{id:"mode-tcp-http-health"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mode-tcp-http-health"}},[s._v("#")]),s._v(" mode { tcp|http|health }")]),s._v(" "),t("p",[s._v("å®šä¹‰haproxyçš„å·¥ä½œæ¨¡å¼\ntcpï¼šåŸºäºlayer4å®ç°ä»£ç†ï¼›å¯ä»£ç†mysql, pgsql, ssh, sslç­‰åè®®,httpsæ—¶ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œé»˜è®¤æ¨¡å¼\nhttpï¼šä»…å½“ä»£ç†åè®®ä¸ºhttpæ—¶ä½¿ç”¨,centoså®é™…é»˜è®¤æ¨¡å¼\nhealthï¼šå·¥ä½œä¸ºå¥åº·çŠ¶æ€æ£€æŸ¥çš„å“åº”æ¨¡å¼ï¼Œå½“è¿æ¥è¯·æ±‚åˆ°è¾¾æ—¶å›åº”â€œOKâ€åå³æ–­å¼€è¿æ¥ï¼Œè¾ƒå°‘ä½¿ç”¨")]),s._v(" "),t("h3",{attrs:{id:"åŸºäºcookieçš„ä¼šè¯ç»‘å®š"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºcookieçš„ä¼šè¯ç»‘å®š"}},[s._v("#")]),s._v(" åŸºäºcookieçš„ä¼šè¯ç»‘å®š")]),s._v(" "),t("p",[s._v("cookie "),t("name",[s._v(" [ rewrite | insert | prefix ] [ indirect ] [ nocache ] [ postonly ] [ preserve ] [ httponly ] [ secure ] [ domain "),t("domain",[s._v(" ]* [ maxidle "),t("idle",[s._v(" ] [ maxlife "),t("life",[s._v(" ]\n"),t("name",[s._v("ï¼šcookieåç§°ï¼Œç”¨äºå®ç°æŒä¹…è¿æ¥\nrewriteï¼šé‡å†™\ninsertï¼šæ’å…¥\nprefixï¼šå‰ç¼€\né…ç½®ç¤ºä¾‹ï¼š")])],1)],1)],1)],1)],1),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("backend websrvs\n  balance     roundrobin\n  cookie WEBSRV insert nocache indirect\n  server   web1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".45.11:80 check cookie srv1\n  server   web2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".45.12:80 check cookie srv2\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æ¯ä¸ªserveræœ‰è‡ªå·±çš„å”¯ä¸€çš„cookieæ ‡è¯†")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#åœ¨backendä¸­ä¸ºç”¨æˆ·è¯·æ±‚è°ƒåº¦å®Œæˆåæ“çºµå…¶cookie")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"ç»Ÿè®¡æ¥å£å¯ç”¨ç›¸å…³çš„å‚æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»Ÿè®¡æ¥å£å¯ç”¨ç›¸å…³çš„å‚æ•°"}},[s._v("#")]),s._v(" ç»Ÿè®¡æ¥å£å¯ç”¨ç›¸å…³çš„å‚æ•°")]),s._v(" "),t("p",[s._v("stats enable\nå¯ç”¨ç»Ÿè®¡é¡µï¼›åŸºäºé»˜è®¤çš„å‚æ•°å¯ç”¨stats page")]),s._v(" "),t("ul",[t("li",[s._v("stats uri : /haproxy?stats urié»˜è®¤å€¼")]),s._v(" "),t("li",[s._v("stats realm : HAProxy Statistics")]),s._v(" "),t("li",[s._v("stats auth : no authentication")])]),s._v(" "),t("p",[s._v("stats uri "),t("prefix",[s._v(" è‡ªå®šä¹‰stats page uri")])],1),s._v(" "),t("p",[s._v("stats auth "),t("user",[s._v(":"),t("passwd",[s._v(" è®¤è¯æ—¶çš„è´¦å·å’Œå¯†ç ï¼Œå¯ä½¿ç”¨å¤šæ¬¡")])],1)],1),s._v(" "),t("p",[s._v("stats realm "),t("realm",[s._v(" è®¤è¯æ—¶çš„realm")])],1),s._v(" "),t("p",[s._v("stats hide-version éšè—ç‰ˆæœ¬")]),s._v(" "),t("p",[s._v("stats refresh "),t("delay",[s._v(" è®¾å®šè‡ªåŠ¨åˆ·æ–°æ—¶é—´é—´éš”")])],1),s._v(" "),t("p",[s._v("stats admin { if | unless } "),t("cond",[s._v(" å¯ç”¨stats pageä¸­çš„ç®¡ç†åŠŸèƒ½")])],1),s._v(" "),t("p",[s._v("é…ç½®ç¤ºä¾‹ï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("listen stats \n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" :9099 \n    stats "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" \n    stats realm HAPorxy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" Stats"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" Page \n    stats auth ç”¨æˆ·åï¼šå¯†ç \n    stats admin "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" TRUE\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#åœ¨frountendä¸­å•ç‹¬å®šä¹‰ä¸€ä¸ªstatsæœåŠ¡ï¼Œç›‘å¬9099ç«¯å£")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å¦‚æœè®¤è¯æˆåŠŸå°±å¼€å¯ç®¡ç†åŠŸèƒ½")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"forwardforé…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#forwardforé…ç½®"}},[s._v("#")]),s._v(" forwardforé…ç½®")]),s._v(" "),t("p",[s._v("option forwardfor [ except "),t("network",[s._v(" ] [ header "),t("name",[s._v(" ] [ if-none ]\nåœ¨ç”±haproxyå‘å¾€åç«¯ä¸»æœºçš„è¯·æ±‚æŠ¥æ–‡ä¸­æ·»åŠ â€œX-ForwardedForâ€é¦–éƒ¨ï¼Œå…¶å€¼ä¸ºå‰ç«¯å®¢æˆ·ç«¯çš„åœ°å€ï¼›ç”¨äºå‘åç«¯ä¸»å‘é€çœŸå®çš„å®¢æˆ·ç«¯IP")])],1)],1),s._v(" "),t("p",[s._v("[ except "),t("network",[s._v(" ]ï¼šè¯·æ±‚æŠ¥è¯·æ¥è‡ªæ­¤å¤„æŒ‡å®šçš„ç½‘ç»œæ—¶ä¸äºˆæ·»åŠ æ­¤é¦–éƒ¨ï¼Œå¦‚haproxyè‡ªèº«æ‰€åœ¨ç½‘ç»œ")])],1),s._v(" "),t("p",[s._v("[ header "),t("name",[s._v(" ]ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„é¦–éƒ¨åç§°ï¼Œè€Œéâ€œXForwarded-Forâ€")])],1),s._v(" "),t("p",[s._v("[ if-none ] å¦‚æœæ²¡æœ‰é¦–éƒ¨æ‰æ·»åŠ é¦–éƒ¨ï¼Œå¦‚æœæœ‰ä½¿ç”¨é»˜è®¤å€¼")]),s._v(" "),t("p",[s._v("ä¸ºæŒ‡å®šçš„MIMEç±»å‹å¯ç”¨å‹ç¼©ä¼ è¾“åŠŸèƒ½\ncompression algo "),t("algorithm",[s._v(" ...ï¼šå¯ç”¨httpåè®®çš„å‹ç¼©æœºåˆ¶ï¼ŒæŒ‡æ˜å‹ç¼©ç®—æ³•gzip, deflate\ncompression type "),t("mime",{attrs:{type:""}},[s._v(" ...ï¼šæŒ‡æ˜å‹ç¼©çš„MIMIç±»å‹")])],1)],1),s._v(" "),t("h3",{attrs:{id:"é”™è¯¯é¡µé…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é”™è¯¯é¡µé…ç½®"}},[s._v("#")]),s._v(" é”™è¯¯é¡µé…ç½®")]),s._v(" "),t("p",[s._v("errorfile "),t("code",[t("file",[s._v(" è‡ªå®šä¹‰é”™è¯¯é¡µ\n"),t("code",[s._v("ï¼šHTTP status code.\næ”¯æŒ200, 400, 403, 408, 500, 502, 503, 504.\n"),t("file",[s._v("ï¼šé”™è¯¯é¡µæ–‡ä»¶è·¯å¾„")])],1)])],1)]),s._v(" "),t("p",[s._v("ç¤ºä¾‹ï¼š\nä½¿ç”¨haproxyä¸»æœºæœ¬åœ°çš„æ–‡ä»¶è¿›è¡Œå“åº”")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("errorfile "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),s._v(" /etc/haproxy/errorfiles/400badreq.http \nerrorfile "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("408")]),s._v(" /dev/null     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# workaround Chrome preconnect bug ")]),s._v("\nerrorfile "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")]),s._v(" /etc/haproxy/errorfiles/403forbid.http \nerrorfile "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" /etc/haproxy/errorfiles/503sorry.http \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("ä½¿ç”¨urlè¿›è¡Œå“åº”ï¼Œå“åº”çŠ¶æ€ç ä¸º302ï¼Œä¸é€‚ç”¨äºGETä»¥å¤–çš„å…¶ä»–è¯·æ±‚æ–¹æ³•ï¼š\nerrorloc "),t("code",[t("url",[s._v(" ç›¸å½“äºerrorloc302 "),t("code",[t("url",[s._v("ï¼Œåˆ©ç”¨302é‡å®šå‘è‡³æŒ‡URL")])],1)])],1)]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("errorloc 503 http://www.a.com/error_pages/503.html\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"ä¿®æ”¹æŠ¥æ–‡é¦–éƒ¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¿®æ”¹æŠ¥æ–‡é¦–éƒ¨"}},[s._v("#")]),s._v(" ä¿®æ”¹æŠ¥æ–‡é¦–éƒ¨")]),s._v(" "),t("p",[s._v("reqadd "),t("string",[s._v(" [{if | unless} "),t("cond",[s._v("]\nåœ¨è¯·æ±‚æŠ¥æ–‡å°¾éƒ¨æ·»åŠ æŒ‡å®šé¦–éƒ¨")])],1)],1),s._v(" "),t("p",[s._v("rspadd "),t("string",[s._v(" [{if | unless} "),t("cond",[s._v("]\nåœ¨å“åº”æŠ¥æ–‡å°¾éƒ¨æ·»åŠ æŒ‡å®šé¦–éƒ¨\nç¤ºä¾‹ï¼š")])],1)],1),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("rspadd X-Via:\\ HAPorxy  #å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼è¦è½¬ä¹‰\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("reqdel "),t("search",[s._v(" [{if | unless} "),t("cond",[s._v("]\nreqidel "),t("search",[s._v(" [{if | unless} "),t("cond",[s._v("] (ignore case) ä¸åˆ†å¤§å°å†™\nä»è¯·æ±‚æŠ¥æ–‡ä¸­åˆ é™¤åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„é¦–éƒ¨")])],1)],1)],1)],1),s._v(" "),t("p",[s._v("rspdel "),t("search",[s._v(" [{if | unless} "),t("cond",[s._v("]\nrspidel "),t("search",[s._v(" [{if | unless} "),t("cond",[s._v("] (ignore case) ä¸åˆ†å¤§å°å†™ä»å“åº”æŠ¥æ–‡ä¸­åˆ é™¤åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„é¦–éƒ¨ ç¤ºä¾‹ï¼š rspidel Server.*")])],1)],1)],1)],1),s._v(" "),t("h3",{attrs:{id:"è¿æ¥è¶…æ—¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿æ¥è¶…æ—¶"}},[s._v("#")]),s._v(" è¿æ¥è¶…æ—¶")]),s._v(" "),t("p",[s._v("timeout client "),t("timeout",[s._v(" å®¢æˆ·ç«¯æœ€é•¿ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é•¿ é»˜è®¤å•ä½æ˜¯æ¯«ç§’\ntimeout server "),t("timeout",[s._v(" åç«¯æœåŠ¡å™¨æœ€é•¿ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é•¿\ntimeout http-keep-alive "),t("timeout",[s._v(" æŒä¹…è¿æ¥çš„æŒä¹…æ—¶é•¿\ntimeout http-request "),t("timeout",[s._v(" ä¸€æ¬¡å®Œæ•´çš„HTTPè¯·æ±‚çš„æœ€å¤§ç­‰å¾…æ—¶é•¿\ntimeout connect "),t("timeout",[s._v(" æˆåŠŸè¿æ¥åç«¯æœåŠ¡å™¨çš„æœ€å¤§ç­‰å¾…æ—¶é•¿\ntimeout client-fin "),t("timeout",[s._v(" å®¢æˆ·ç«¯åŠè¿æ¥çš„ç©ºé—²æ—¶é•¿\ntimeout server-fin "),t("timeout",[s._v(" åç«¯æœåŠ¡å™¨åŠè¿æ¥çš„ç©ºé—²æ—¶é•¿")])],1)],1)],1)],1)],1)],1)],1),s._v(" "),t("h2",{attrs:{id:"acl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#acl"}},[s._v("#")]),s._v(" ACL")]),s._v(" "),t("p",[s._v("aclï¼šhaproxyçš„ACLç”¨äºå®ç°åŸºäºè¯·æ±‚æŠ¥æ–‡çš„é¦–éƒ¨ã€å“åº”æŠ¥æ–‡çš„å†…å®¹æˆ–å…¶ä»–çš„ç¯å¢ƒçŠ¶æ€ä¿¡æ¯æ¥åšå‡ºè½¬å‘å†³ç­–ï¼Œè¿™å¤§å¤§å¢åŠ äº†å…¶é…ç½®å¼¹æ€§ã€‚å…¶é…ç½®æ³•åˆ™ä¸€èˆ¬åˆ†ä¸ºä¸¤éƒ¨ï¼Œé¦–å…ˆå®šä¹‰ACLï¼Œæ—¢å®šä¹‰ä¸€ä¸ªæµ‹è¯•æ¡ä»¶ï¼Œè€Œååœ¨æ¡ä»¶å¾—åˆ°æ»¡è¶³æ—¶æ‰§è¡ŒæŸç‰¹å®šåŠ¨ä½œï¼Œå¦‚é˜»æ­¢è®¿é—®æˆ–è€…è½¬å‘è‡³æŸç‰¹å®šçš„åç«¯ï¼Œ\nå®šä¹‰ACLçš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š\nacl "),t("aclname",[t("criterion",[s._v(" [flags] [operator] ["),t("value",[s._v("] ...")])],1)],1)],1),s._v(" "),t("p",[t("aclname",[s._v("ï¼šACLåç§°ï¼Œå¯ä½¿ç”¨å­—æ¯ æ•°å­— : . - _ åŒºåˆ†å­—ç¬¦å¤§å°å†™")])],1),s._v(" "),t("p",[t("criterion",[s._v("ï¼š æŒ‡æ˜æ£€æŸ¥æ¡ä»¶\nå„ç§æ¡ä»¶ :\ndst ç›®æ ‡IP\ndst_port ç›®æ ‡PORT\nsrc æºIP\nsrc_port æºPORT\nç¤ºä¾‹ï¼š")])],1),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("acl invalid_src src 172.16.100.200\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("value",[s._v("çš„ç±»å‹ï¼š")])],1),s._v(" "),t("ul",[t("li",[s._v("boolean")]),s._v(" "),t("li",[s._v("integer or integer range")]),s._v(" "),t("li",[s._v("IP address / network")]),s._v(" "),t("li",[s._v("string (exact, substring, suffix, prefix, subdir, domain)")]),s._v(" "),t("li",[s._v("regular expression")]),s._v(" "),t("li",[s._v("hex block")])]),s._v(" "),t("flags",[s._v("\n-i ä¸åŒºåˆ†å¤§å°å†™\n-m ä½¿ç”¨æŒ‡å®šçš„patternåŒ¹é…æ–¹æ³•\n-n ä¸åšDNSè§£æ\n-u å¼ºåˆ¶æ¯ä¸ªACLå¿…é¡»å”¯ä¸€IDï¼Œå¦åˆ™å¤šä¸ªåŒåACLæˆ–å…³ç³»\n-- å¼ºåˆ¶flagç»“æŸ. å½“å­—ç¬¦ä¸²å’ŒæŸä¸ªflagç›¸ä¼¼æ—¶ä½¿ç”¨\n"),t("p",[s._v("[operator]\nåŒ¹é…æ•´æ•°å€¼ï¼šeqã€geã€gtã€leã€lt\nåŒ¹é…å­—ç¬¦ä¸²ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("exact match (-m str) :å­—ç¬¦ä¸²å¿…é¡»å®Œå…¨åŒ¹é…æ¨¡å¼")]),s._v(" "),t("li",[s._v("substring match (-m sub) :åœ¨æå–çš„å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾æ¨¡å¼ï¼Œ å¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªè¢«å‘ç°ï¼ŒACLå°†åŒ¹é…")]),s._v(" "),t("li",[s._v("prefix match (-m beg) :åœ¨æå–çš„å­—ç¬¦ä¸²é¦–éƒ¨ä¸­æŸ¥æ‰¾æ¨¡å¼ ï¼Œå¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªè¢«å‘ç°ï¼ŒACLå°†åŒ¹é…")]),s._v(" "),t("li",[s._v("suffix match (-m end) :å°†æ¨¡å¼ä¸æå–å­—ç¬¦ä¸²çš„å°¾éƒ¨è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªåŒ¹é…ï¼Œåˆ™ACLè¿›è¡ŒåŒ¹é…")]),s._v(" "),t("li",[s._v("subdir match (-m dir) :æŸ¥çœ‹æå–å‡ºæ¥çš„ç”¨æ–œçº¿åˆ†éš”ï¼ˆ â€œ/â€ï¼‰çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªåŒ¹é…ï¼Œåˆ™ACLè¿›è¡ŒåŒ¹é…")]),s._v(" "),t("li",[s._v("domain match (-m dom) :æŸ¥æ‰¾æå–çš„ç”¨ç‚¹ï¼ˆâ€œ.â€ï¼‰åˆ†éš” å­—ç¬¦ä¸²ï¼Œå¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªåŒ¹é…ï¼Œåˆ™ACLè¿›è¡ŒåŒ¹é…")])]),s._v(" "),t("h3",{attrs:{id:"aclä½œä¸ºæ¡ä»¶æ—¶çš„é€»è¾‘å…³ç³»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#aclä½œä¸ºæ¡ä»¶æ—¶çš„é€»è¾‘å…³ç³»"}},[s._v("#")]),s._v(" aclä½œä¸ºæ¡ä»¶æ—¶çš„é€»è¾‘å…³ç³»:")]),s._v(" "),t("ul",[t("li",[s._v("ä¸ï¼šéšå¼ï¼ˆé»˜è®¤ï¼‰ä½¿ç”¨")]),s._v(" "),t("li",[s._v("æˆ–ï¼šä½¿ç”¨â€œorâ€ æˆ– â€œ||â€è¡¨ç¤º")]),s._v(" "),t("li",[s._v("å¦å®šï¼šä½¿ç”¨â€œ!â€œ è¡¨ç¤º")])]),s._v(" "),t("p",[s._v("ç¤ºä¾‹ï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" invalid_src invalid_port ä¸å…³ç³» \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" invalid_src "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" invalid_port æˆ– \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" invalid_src é \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"base-string"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#base-string"}},[s._v("#")]),s._v(" base : string")]),s._v(" "),t("p",[s._v("è¿”å›ç¬¬ä¸€ä¸ªä¸»æœºå¤´å’Œè¯·æ±‚çš„è·¯å¾„éƒ¨åˆ†çš„è¿æ¥ï¼Œè¯¥è¯·æ±‚ä»ç¬¬ä¸€ä¸ªæ–œæ å¼€å§‹ï¼Œå¹¶åœ¨é—®å·ä¹‹å‰ç»“æŸ,å¯¹è™šæ‹Ÿä¸»æœºæœ‰ç”¨\n"),t("scheme",[s._v("ğŸ˜•/"),t("user",[s._v(":"),t("password",[s._v("@"),t("host",[s._v(":"),t("port",[s._v("/"),t("path",[s._v(";< params>?"),t("query",[s._v("#"),t("frag",[s._v("\nbase : exact string match\nbase_beg : prefix match\nbase_dir : subdir match\nbase_dom : domain match\nbase_end : suffix match\nbase_len : length match\nbase_reg : regex match\nbase_sub : substring match")])],1)],1)])],1)],1)],1)],1)],1),s._v(" "),t("h3",{attrs:{id:"path-string"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#path-string"}},[s._v("#")]),s._v(" path : string")]),s._v(" "),t("p",[s._v("æå–è¯·æ±‚çš„URLè·¯å¾„ï¼Œè¯¥è·¯å¾„ä»ç¬¬ä¸€ä¸ªæ–œæ å¼€å§‹ï¼Œå¹¶åœ¨é—®å·ä¹‹ å‰ç»“æŸï¼ˆæ— ä¸»æœºéƒ¨åˆ†ï¼‰\n"),t("scheme",[s._v("ğŸ˜•/"),t("user",[s._v(":"),t("password",[s._v("@"),t("host",[s._v(":"),t("port",[s._v("/"),t("path",[s._v(";< params>?"),t("query",[s._v("#"),t("frag",[s._v("\npath : exact string match\npath_beg : prefix match åŒ¹é…è·¯å¾„å¼€å¤´\npath_dir : subdir match\npath_dom : domain match\npath_end : suffix match åŒ¹é…è·¯å¾„ç»“å°¾\npath_len : length match\npath_reg : regex match æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸€ç±»PATH\npath_sub : substring match")])],1)],1)])],1)],1)],1)],1)],1),s._v(" "),t("h3",{attrs:{id:"url-string"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#url-string"}},[s._v("#")]),s._v(" url : string")]),s._v(" "),t("p",[s._v("æå–è¯·æ±‚ä¸­çš„URLã€‚ä¸€ä¸ªå…¸å‹çš„åº”ç”¨æ˜¯å…·æœ‰é¢„å–èƒ½åŠ›çš„ç¼“å­˜ï¼Œ ä»¥åŠéœ€è¦ä»æ•°æ®åº“èšåˆå¤šä¸ªä¿¡æ¯å¹¶å°†å®ƒä»¬ä¿å­˜åœ¨ç¼“å­˜ä¸­çš„ç½‘é¡µé—¨æˆ·å…¥å£\nurl : exact string match\nurl_beg : prefix match URLå¼€å¤´ï¼ŒåŒ¹é…åè®®\nurl_dir : subdir match\nurl_dom : domain match\nurl_end : suffix match URLç»“å°¾\nurl_len : length match\nurl_reg : regex match æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸€ç±»url\nurl_sub : substring match")]),s._v(" "),t("h3",{attrs:{id:"req-hdr"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#req-hdr"}},[s._v("#")]),s._v(" req.hdr([")]),s._v(" "),t("p",[s._v("æå–åœ¨ä¸€ä¸ªHTTPè¯·æ±‚æŠ¥æ–‡çš„é¦–éƒ¨\nhdr(["),t("name",[s._v("[,"),t("occ",[s._v("]]) : exact string match\nhdr_beg(["),t("name",[s._v("[,"),t("occ",[s._v("]]) : prefix match é¦–éƒ¨å¼€å¤´\nhdr_dir(["),t("name",[s._v("[,"),t("occ",[s._v("]]) : subdir match\nhdr_dom(["),t("name",[s._v("[,"),t("occ",[s._v("]]) : domain match\nhdr_end(["),t("name",[s._v("[,"),t("occ",[s._v("]]) : suffix match é¦–éƒ¨ç»“å°¾\nhdr_len(["),t("name",[s._v("[,"),t("occ",[s._v("]]) : length match\nhdr_reg(["),t("name",[s._v("[,"),t("occ",[s._v("]]) : regex match\nhdr_sub(["),t("name",[s._v("[,"),t("occ",[s._v("]]) : substring match\nç¤ºä¾‹ï¼š")])],1)],1)],1)],1)],1)],1)],1)],1)],1)],1)],1)],1)],1)],1)],1)],1),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("acl bad_curl hdr_sub"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("User-Agent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" \nblock "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" bad_curl \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"status-integer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#status-integer"}},[s._v("#")]),s._v(" status : integer")]),s._v(" "),t("p",[s._v("è¿”å›åœ¨å“åº”æŠ¥æ–‡ä¸­çš„çŠ¶æ€ç ")]),s._v(" "),t("h3",{attrs:{id:"é¢„å®šä¹‰acl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é¢„å®šä¹‰acl"}},[s._v("#")]),s._v(" é¢„å®šä¹‰ACL")]),s._v(" "),t("p",[s._v("ACLåç§° ç­‰ä»·äº è¯´æ˜\nTRUE always_true æ€»æ˜¯åŒ¹é…\nFALSE always_false ä»ä¸åŒ¹é…\nHTTP req_proto_http åŒ¹é…HTTPåè®®\nHTTP_1.0 req_ver 1.0 åŒ¹é…HTTPåè®®1.0\nHTTP_1.1 req_ver 1.1 åŒ¹é…HTTPåè®®1.1\nHTTP_CONTENT hdr_val(content-length) gt 0 åŒ¹é…å·²å­˜åœ¨å†…å®¹é•¿åº¦\nHTTP_URL_ABS url_reg ^[^/:]"),t("em",[s._v('ğŸ˜•/ åŒ¹é…URLç»å¯¹è·¯å¾„\nHTTP_URL_SLASHurl_beg / åŒ¹é…URLç›¸å¯¹è·¯å¾„\nHTTP_URL_STAR url * åŒ¹é… URL ç­‰äº "')]),s._v('"\nLOCALHOST src 127.0.0.1/8 åŒ¹é…ä»localhostæ¥çš„è¿æ¥\nMETH_CONNECT method CONNECT åŒ¹é…HTTP CONNECTæ–¹æ³•\nMETH_GETmethod GET HEAD #match HTTP GET or HEAD method\nMETH_HEAD method HEAD #match HTTP HEAD method\nMETH_OPTIONS method OPTIONS #match HTTP OPTIONS method\nMETH_POST method POST #match HTTP POST method\nMETH_TRACE method TRACE #match HTTP TRACE method\nRDP_COOKIE req_rdp_cookie_cnt gt 0 #match presence of an RDP cookie\nREQ_CONTENT req_len gt 0 #match data in the request buffer\nWAIT_ENDwait_end #wait for end of content analysis')]),s._v(" "),t("h3",{attrs:{id:"aclé…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#aclé…ç½®"}},[s._v("#")]),s._v(" aclé…ç½®")]),s._v(" "),t("h4",{attrs:{id:"åŸºäºipçš„è®¿é—®æ§åˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºipçš„è®¿é—®æ§åˆ¶"}},[s._v("#")]),s._v(" åŸºäºIPçš„è®¿é—®æ§åˆ¶")]),s._v(" "),t("p",[s._v("use_backend "),t("backend",[s._v(" [{if | unless} "),t("condition",[s._v("]\nå½“if/unlessä¸€ä¸ªåŸºäºACLçš„æ¡ä»¶åŒ¹é…æ—¶åˆ‡æ¢æŒ‡å®šbackend")])],1)],1),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("acl invalid_src src "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".200.2 \nblock "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" invalid_src \nerrorfile "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")]),s._v(" /etc/fstab\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"ä¸ƒå±‚è¯·æ±‚çš„è®¿é—®æ§åˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ƒå±‚è¯·æ±‚çš„è®¿é—®æ§åˆ¶"}},[s._v("#")]),s._v(" ä¸ƒå±‚è¯·æ±‚çš„è®¿é—®æ§åˆ¶")]),s._v(" "),t("p",[s._v("http-request { allow | deny |add-header "),t("name",[t("fmt",[s._v(" |set-header "),t("name",[t("fmt",[s._v(" } [ { if | unless } "),t("condition",[s._v(" ]")])],1)],1)],1)],1)],1),s._v(" "),t("h4",{attrs:{id:"å››å±‚è¯·æ±‚è®¿é—®æ§åˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å››å±‚è¯·æ±‚è®¿é—®æ§åˆ¶"}},[s._v("#")]),s._v(" å››å±‚è¯·æ±‚è®¿é—®æ§åˆ¶")]),s._v(" "),t("p",[s._v("tcp-request connection {accept|reject} [{if | unless} "),t("condition",[s._v("]\nç¤ºä¾‹ï¼š")])],1),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("listen "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" :22022 \nbalance leastconn \nacl invalid_src src "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".200.2 \ntcp-request connection reject "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" invalid_src \nmode tcp \nserver sshsrv1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".100.6:22 check \nserver sshsrv2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".100.7:22 check backup\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h4",{attrs:{id:"åŸºäºaclçš„åŠ¨é™åˆ†ç¦»ç¤ºä¾‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºaclçš„åŠ¨é™åˆ†ç¦»ç¤ºä¾‹"}},[s._v("#")]),s._v(" åŸºäºACLçš„åŠ¨é™åˆ†ç¦»ç¤ºä¾‹")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("frontend  web *:80 \n    acl url_static       path_beg       -i /static /images /javascript /stylesheets \n    acl url_static       path_end       -i .jpg .gif .png .css .js .html .txt .htm \n    use_backend staticsrvs       "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" url_static \n    default_backend             appsrvs \nbackend staticsrvs \n    balance     roundrobin \n    server      stcsrv1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".100.6:80 check \nbackend appsrvs \n    balance     roundrobin \n    server  app1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".100.7:80 check \n    server  app1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".100.7:8080 check \nlisten stats \n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" :9091 \n    stats "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" \n    stats auth admin:admin \n    stats admin "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" TRUE\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä¸€ä¸ªACLå®šä¹‰äº†ä¸¤ä¸ªæ¡ä»¶ï¼Œå¦‚æœç”¨æˆ·çš„è¯·æ±‚æ»¡è¶³PATHä¸­å¸¦æœ‰/static /images /javascript /stylesheets è¿™äº›å­—ç¬¦çš„ï¼Œæˆ–è€…pathæ˜¯ä»¥.jpg .gif .png .css .js .html .txt .htm è¿™äº›å­—ç¬¦ç»“å°¾çš„å°±åŒ¹é…ACLå®šä¹‰")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#æ»¡è¶³ACLå®šä¹‰çš„è¯·æ±‚ä¸ºé™æ€è¯·æ±‚ï¼Œè¢«è°ƒåº¦åˆ°åç«¯çš„staticsrvsæœºç»„ä¸Š")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä¸æ»¡ç»„ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶çš„è¯·æ±‚é»˜è®¤è°ƒåº¦éƒ½åç«¯åŒ…å«ä¸¤å°æœåŠ¡å™¨è½®è¯¢çš„appsrvsæœºç»„ä¸Š")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h3",{attrs:{id:"æ”¯æŒhttpsåè®®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ”¯æŒhttpsåè®®"}},[s._v("#")]),s._v(" æ”¯æŒhttpsåè®®")]),s._v(" "),t("p",[s._v("é…ç½®HAProxyæ”¯æŒhttpsåè®®ï¼š\n1 æ”¯æŒsslä¼šè¯ï¼›\nbind *:443 ssl crt /PATH/TO/SOME_PEM_FILE\ncrt åè¯ä¹¦æ–‡ä»¶ä¸ºPEMæ ¼å¼ï¼Œä¸”åŒæ—¶åŒ…å«è¯ä¹¦å’Œæ‰€æœ‰ç§é’¥\ncat demo.crt demo.key > demo.pem")]),s._v(" "),t("p",[s._v("2 æŠŠ80ç«¯å£çš„è¯·æ±‚é‡å‘å®š443\nbind *:80\nredirect scheme https if !{ ssl_fc }")]),s._v(" "),t("p",[s._v("3 å‘åç«¯ä¼ é€’ç”¨æˆ·è¯·æ±‚çš„åè®®å’Œç«¯å£ï¼ˆfrontendæˆ–backendï¼‰\nhttp_request set-header X-Forwarded-Port %[dst_port]\nhttp_request add-header X-Forwared-Proto https if { ssl_fc }")])])],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);